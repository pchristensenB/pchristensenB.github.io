
<!--
Author: W3layouts
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html>
<head>
<title>Compare documents</title>
<!-- for-mobile-apps -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!-- //for-mobile-apps -->
<link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/elements/9.1.1/en-US/picker.css" />
<script src="https://cdn01.boxcdn.net/platform/elements/9.1.1/en-US/picker.js"></script>

<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
  <script
    src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script>
  var   filePicker = new Box.FilePicker();
  var src;
var ids=[];
  var params = new URLSearchParams(window.location.search);
  $(document).ready(function(){
    $("#dialog").dialog({
      autoOpen: false,
      modal: true,
      height:800,
      width:600,

      open: function(ev, ui){
             $('#compareFrame').attr('src',src);
          }
    });
    var userLogin = 'pchristensen+demo@box.com';
	  var clientId="bn2iyg37p78jkowrp0io0nc2ln0be3wt";
    var urlParams = "code=Jq4te0OgMV6LCHpC0NrJu91aZpS/M0x56e6MzZdROAEL2kdkocaLmA==&clientId=" + clientId + "&userEmail=" + userLogin;
    var token;
    $.ajax({
      //url: 'https://box-heroku-token-generator.herokuapp.com/jwttokengenerator?',
      url: 'http://localhost:5000/jwttokengenerator?',
      headers: {},
      type: 'get',
      data:urlParams,
      success: function(response) {
        console.log("Success:" + response);

        token=response.token;
          filePicker.show('70880002908', response.token, {
              container: '.fileChooser',
              maxSelectable: 2,
              contentPreviewProps: {
                  contentSidebarProps: {
                    hasMetadata: false,
                    hasSkills: true,
                    hasProperties: true,
                    hasAccessStats: true,
                    hasActivityFeed: true,
                  defaultView:'activityFeed'
                },
                contentOpenWithProps: {
                  show: true
                }
              }
          });
          filePicker.addListener('choose', function(response) {
            console.log("response:" + response);
            $.each(response, function(k, data) {
                ids.push(data.id);
            });
            var id1=ids[0];
            var id2=ids[1];

            $.ajax({
              //url: 'https://box-heroku-token-generator.herokuapp.com/jwttokengenerator?',
              url: 'https://cvw2zdcqpc.execute-api.eu-west-2.amazonaws.com/default/box-document-compare?id1='+id1 + '&id2='+id2 + '&token=' + token,
              headers: {},
              type: 'get',
              data:{},
              success: function(response) {
                $(".fileChooser").hide();
                console.log(JSON.stringify(response));
                console.log(response.url)
                src=response.url;
                $('#dialog').dialog('open');


              }
            });
          });
        }

        ,
        error: function(data) {

        }
      });
});

</script>

</head>
<body>
  <div class="content" id='main'>

  		<div class="fileChooser" style="height:600px;"></div>
      <div id="dialog" style="display:none;">
          <iframe id="compareFrame" src=""></iframe>
      </div>
  </div>
</body>
</html>
