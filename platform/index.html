<html>

<head>
  <title>Box platform workbench</title>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link href="//netdna.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <link href="/platform/index.css" rel="stylesheet">
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script>
    //declare event to run when div is visible

    function clearFrames() {
      $("#frame_workbench").attr("src", "");
      $("#frame_webhook").attr("src", "");
      $("#frame_collabreport").attr("src", "");
      $("#frame_scopes").attr("src", "");
      $("#frame_canviewpath").attr("src", "");

    }
    $(document).ready(function() {


      $("div.bhoechie-tab-menu>div.list-group>a").click(function(e) {
        e.preventDefault();
        $(this).siblings('a.active').removeClass("active");
        $(this).addClass("active");
        var index = $(this).index();
        $("div.bhoechie-tab>div.bhoechie-tab-content").removeClass("active");
        $("div.bhoechie-tab>div.bhoechie-tab-content").eq(index).addClass("active");
        var id = $("div.bhoechie-tab>div.bhoechie-tab-content").eq(index).attr("id");
        clearFrames();
        $("#frame_" + id).attr("src", "/platform/" + id + "/index.html?app=" + sessionStorage.getItem("clientId"));
      });
      if (sessionStorage.getItem("clientId") == null) {
        $('#myModal').modal("show");
        $( "#tabs" ).tabs();
      }
      $("#modalClient").click(function(e) {
        $("#cloader").show();
        $("#modal-body").hide();
        $.get("http://localhost:5000/sandpit", {
            cmd: "getApp",
            app: $("#clientId").val(),
            data: $("#email").val(),
            jwtfile: $("#jwtfile").val(),
          })
          .done(function(data) {
            console.log(data);
            if (data != '"NOT FOUND"') {
              $("#myModal").modal("hide");
              sessionStorage.setItem("clientId", data.replace('"', '').replace('"', ''));
            } else {
              window.location.replace("/register.html?includeMessage=true");
            }
          });
      });

    });
  </script>
</head>

<body>
  <div style="margin-left:5px;width:100%;" class="container">
    <div class="row">
      <div class="col-lg-12 col-md-12  bhoechie-tab-container">
        <div class="col-lg-1 col-md-1  bhoechie-tab-menu">
          <div class="list-group">
            <a href="#" class="list-group-item active text-center">
              <h4 class="glyphicon glyphicon-doc"></h4><br/>Readme
            </a>
            <a href="#" class="list-group-item text-center">
              <h4 class="glyphicon glyphicon-wrench"></h4><br/>Workbench
            </a>
            <a href="#" class="list-group-item text-center">
              <h4 class="glyphicon glyphicon-file"></h4><br/>Scopes
            </a>
            <a href="#" class="list-group-item text-center">
              <h4 class="glyphicon glyphicon-random"></h4><br/>Can-view-path
            </a>
            <a href="#" class="list-group-item text-center">
              <h4 class="glyphicon glyphicon-globe"></h4><br/>Webhooks
            </a>
            <a href="#" class="list-group-item text-center">
              <h4 class="glyphicon glyphicon-comment"></h4><br/>Collaboration Report
            </a>
            <a href="#" class="list-group-item text-center">
              <h4 class="glyphicon glyphicon-list-alt"></h4><br/>Webhook Report
            </a>

          </div>
        </div>
        <div class="col-lg-11 col-md-11 bhoechie-tab">
          <div class="bhoechie-tab-content active">
            This platform toolbox has a number of functions to test and try
            <ul>
              <li>Workbench: Log in as any user and browse via UI element or custom list. See API calls being made and stream Box events directly</li>
              <li>Scopes: Shows how scoped tokens work. Select a user, a file or folder and show differene between scoped and standard token</li>
              <li>Can view path: See how the 'can view path' collaboration works</li>
              <li>Webhooks: Show how a live webhook responds. Select user, folder or file and event and webhook payload will be send to the browser</li>
              <li>Collaboration Report: Generates a (nice) report of all collaborators in a folder structure</li>
              <li>Webhook Report: Generates a (nice) report of all V2 webhooks in an enterprise (requires the jwt app to have 'Manage webhooks' permissions and 'Enterprise' scope if you want report on all users)</li>
            </ul>
          </div>
          <div class="bhoechie-tab-content " id="workbench">
            <iframe id="frame_workbench" src="" width="100%" height="100%" frameborder="0">
                     </iframe>
          </div>
          <div id="scopes" class="bhoechie-tab-content">
            <iframe id="frame_scopes" src="" width="100%" height="100%" frameborder="0">
                       </iframe>
          </div>


          <div id="canviewpath" class="bhoechie-tab-content">
            <iframe id="frame_canviewpath" src="" width="100%" height="100%" frameborder="0">
                       </iframe>
          </div>
          <div id="webhook" class="bhoechie-tab-content">
            <iframe id="frame_webhook" src="" width="100%" height="100%" frameborder="0">
                       </iframe>
          </div>
          <div id="collabreport" class="bhoechie-tab-content">
            <iframe id="frame_collabreport" src="" width="100%" height="100%" frameborder="0">
                   </iframe>
          </div>
          <div id="webhookreport" class="bhoechie-tab-content">
            <iframe id="frame_webhookreport" src="" width="100%" height="100%" frameborder="0">
                   </iframe>
          </div>
          <div class="bhoechie-tab-content">
            <select class=".userselector">

                      </select>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal" tabindex="-1" role="dialog" id="myModal">
    <div class="modal-dialog" role="document">

      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Set clientId</h5>
          <img src="./ajax-loader_t.gif" class="cloader" />

        </div>
        <div class="modal-body">
          <div id="tabs">
            <ul>
              <li><a href="#tabs-1">Use registered ClientID</a></li>
              <li><a href="#tabs-2">Use temporary JWT config file</a></li>
            </ul>
            <div id="tabs-1">
              <p>Please enter client ID below</p>
              <input type=text name=clientId id="clientId" />
              <p>Please enter your emaibelow</p>
              <input type=text name=email id="email" />
            </div>
            <div id="tabs-2">
              <p>Please paste your JWT config file below</p>
              <p><b>NOTE: You have to add https://box-java-sandpit.herokuapp.com to the CORS
                section of your app before proceeding - goto <a href="https://app.box.com/developers/console" target="_new">Dev Console</a></b></p>

              <textarea cols=40 rows=10 name="jwtfile" id="jwtfile"></textarea>
            </div>

          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="modalClient">Set ClientId</button>

        </div>
      </div>
    </div>
  </div>

</body>
